<!doctype html>

<head>
	<title>Word Karaoke - Read Faster!</title>
	<link rel="stylesheet" href="stylesheet.css">
</head>

<center>
<h1>Word Karaoke - Read Faster!</h1>

<form onsubmit="handleInputs(); return false;">
	<textarea rows="10" cols="60" id="intext" autofocus>Enter Karaoke Text</textarea><br>
	Text File (or input above) : <input type='file' accept='text/plain' id="infile" onchange="recordFileUpload();"><br>
	Speed (Milliseconds): <input type="number" id="speed_input">
	<input type="submit" value="Go!">
</form>
<br>
<div id="wordContainer" class="boxed">-</div>

<script>

var fileUploaded = false;

function recVals(text) {
	console.log("reached recvals");

	if (text == "") {
		var text = document.getElementById("intext").value;
	}

	var speedMs = document.getElementById("speed_input").value;

	console.log("speed is" + speedMs);

	document.getElementById("intext").value = "";

	console.log("text is " + text);
	var text_split = text.split(" ");
	console.log("text_split is " + text_split + ", type " + typeof(text_split));
	var i = -1;
	myLoop(text_split, i, speedMs);

	// text_split.forEach(async function(currentWord){
	// 	await sleep(2000);
	// 	console.log("ran , showing " + currentWord);
	// 	document.getElementById("wordContainer").innerHTML = currentWord;
	// });

	// return false;
}

function myLoop (textArray, startVar, speedMs) {
	var i=startVar;
	setInterval(function () {
		console.log("reached timeout function");
		i++;
		if (i < textArray.length) {
			document.getElementById("wordContainer").innerHTML = textArray[i];
		} else {document.location.href="";}
	}, speedMs)
}

var openFile = function(input) {
	var reader = new FileReader();
	reader.onload = function(){
		var text = reader.result;
		console.log(text.substring(0, 200));
		recVals(text);
	};
	reader.readAsText(input.files[0]);
};

function handleInputs() {
	if (fileUploaded) {
		openFile(document.getElementById("infile"));
	} else {
		recVals(document.getElementById("intext").value);
	}
}

function recordFileUpload() {
	fileUploaded = true;
}

</script>

</html>